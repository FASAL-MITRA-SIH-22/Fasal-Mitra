events {
    worker_connections 1024;
}

http {

    resolver 127.0.0.11 valid=10s;

    server {
        listen 8080;

        #     location /test {
        #     auth_request /auth;
        #     auth_request_set $authentication_id $sent_http_uid;
        #     proxy_pass http://test:8080/test;
        #     proxy_set_header uid $authentication_id;
        # }


        # location /api/dl {
        #     auth_request /api/auth;
        #     auth_request_set $authentication_id $sent_http_uid;
        #     proxy_pass http://dl:8080/api/dl;
        #     proxy_set_header uid: $authentication_id;
        # }


        location /api/dl {
            set $dl_service dl:8080;
            proxy_pass http://$dl_service;
        }

        location /api/auth {
            set $auth_service auth:8080;
            proxy_pass http://$auth_service;
        }

        location /api/auth/authorization {
            internal;
            set $auth_service auth:8080;
            proxy_pass_request_body off;
            proxy_set_header Content-Length "";
            proxy_pass http://$auth_service/api/auth/authorization;
        }
    }
}